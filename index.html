<!DOCTYPE html><html lang="zh-CN"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">    <title>dc:songsheng99免费发布</title>    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>    <style>        :root {            --bg-body: #f5f5f7;            --card-bg: #ffffff;            --text-main: #1d1d1f;            --text-sub: #6e7781;            --accent: #000000;            --border-color: #e1e4e8;            --shadow: 0 5px 15px rgba(0, 0, 0, 0.05);            --radius: 16px;        }        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }        body {            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", "PingFang SC", "Microsoft YaHei", sans-serif;            background-color: var(--bg-body);            color: var(--text-main);            margin: 0;            padding: 20px;        }        .container { max-width: 600px; margin: 0 auto; display: flex; flex-direction: column; gap: 24px; }        header { text-align: center; }        h1 { font-size: 26px; font-weight: 700; margin: 0 0 8px 0; }        .date-input {            width: 100%; border: none; background: transparent; font-size: 14px;            color: var(--text-sub); text-align: center; font-family: inherit;            outline: none; font-weight: 500; padding: 5px; border-radius: 8px;            transition: background 0.2s;        }        .date-input:focus { background: rgba(0,0,0,0.05); }        .upload-card {            background: var(--accent); color: white; border-radius: var(--radius);            padding: 20px; text-align: center; cursor: pointer;            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);            transition: transform 0.15s ease;        }        .upload-card:active { transform: scale(0.97); }        .upload-card-title { font-size: 18px; font-weight: 600; }        .upload-card-sub { font-size: 12px; opacity: 0.8; margin-top: 4px; }        input[type="file"] { display: none; }        #status { text-align: center; font-size: 14px; color: var(--text-sub); height: 20px; transition: color 0.3s; }        .result-area { opacity: 0; transform: translateY(20px); transition: all 0.5s ease-out; pointer-events: none; }        .result-area.show { opacity: 1; transform: translateY(0); pointer-events: auto; }        .card { background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow); padding: 24px; }                .dashboard .main-stat .value { font-size: 44px; font-weight: 800; color: var(--text-main); line-height: 1.1; letter-spacing: -1px; text-align: center; }        .dashboard .main-stat .label { font-size: 14px; color: var(--text-sub); text-align: center; margin-top: 8px; font-weight: 500; }                .divider { height: 1px; background: var(--border-color); margin: 24px 0; }        .sub-stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; text-align: center; }        .sub-stats-grid .value { font-size: 22px; font-weight: 700; }        .sub-stats-grid .label { font-size: 12px; color: var(--text-sub); margin-top: 4px; }                .raw-data-row { display: flex; justify-content: space-around; text-align: center; font-size: 13px; color: var(--text-sub); background: #f7f9fa; padding: 12px; border-radius: 12px; margin-top: 20px; }        .raw-data-row strong { color: var(--text-main); font-weight: 600; }        .list-controls { display: flex; flex-direction: column; gap: 16px; margin-bottom: 16px; }        .search-box { width: 100%; padding: 12px 16px; font-size: 15px; border-radius: 12px; border: 1px solid var(--border-color); background: #fdfdfd; }        .search-box:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(0,0,0,0.1); outline: none; }                /* --- 新增：搜索结果汇总面板样式 --- */        #search-summary {            background: #f0f2f5;            border-radius: 12px;            padding: 16px;            margin-bottom: 16px;            display: none; /* 默认隐藏 */            text-align: center;        }        #search-summary .summary-title { font-weight: 600; font-size: 14px; margin-bottom: 12px; }        #search-summary .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }        #search-summary .summary-item .value { font-size: 18px; font-weight: 700; }        #search-summary .summary-item .label { font-size: 11px; color: var(--text-sub); margin-top: 2px; }        /* --- 样式结束 --- */        .sort-buttons { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }        .sort-btn {            padding: 8px 14px; border: 1px solid var(--border-color); background: transparent;            border-radius: 8px; font-size: 13px; font-weight: 500; color: var(--text-sub); cursor: pointer;            transition: all 0.2s;        }        .sort-btn.active { background: var(--accent); color: white; border-color: var(--accent); }        .file-list .file-card {            display: flex; flex-direction: column; gap: 12px; padding: 16px;            border: 1px solid var(--border-color); border-radius: 12px; margin-bottom: 12px;            background: white;        }        .file-card-header { display: flex; flex-direction: column; gap: 4px; }        .file-card-name { font-weight: 600; font-size: 15px; word-break: break-all; }        .file-card-raw-chars { font-size: 12px; color: var(--text-sub); }        .file-card-stats {            display: grid; grid-template-columns: 1fr auto; align-items: end; gap: 16px;            border-top: 1px solid var(--border-color); padding-top: 12px;        }        .file-card-details { display: flex; flex-direction: column; gap: 6px; font-size: 13px; color: var(--text-sub); }        .file-card-details strong { color: var(--text-main); font-weight: 600; }        .file-card-cn { text-align: right; }        .file-card-cn .value { font-size: 24px; font-weight: 700; color: var(--text-main); }        .file-card-cn .label { font-size: 11px; color: var(--text-sub); }    </style></head><body><div class="container">    <header>        <h1>我们的故事是一本多少字的书</h1>        <input type="text" class="date-input" value="2025年3月6日 - 2025年12月31日">    </header>    <label class="upload-card">        <div class="upload-card-title">上传 ZIP 压缩包</div>        <div class="upload-card-sub">本地处理 · 隐私安全 · 功能完整</div>        <input type="file" id="fileInput" accept=".zip">    </label>    <div id="status">等待上传文件</div>    <div id="resultArea" class="result-area">        <div class="card dashboard">            <!-- 全局统计内容保持不变 -->        </div>                <div class="file-list">            <div class="list-controls">                <input type="search" id="searchBox" class="search-box" placeholder="搜索文件名...">                <div class="sort-buttons" id="sortButtons">                    <!-- 排序按钮保持不变 -->                </div>            </div>                        <!-- --- 新增：搜索结果汇总面板的HTML结构 --- -->            <div id="search-summary">                <div class="summary-title">搜索结果统计</div>                <div class="summary-grid">                    <div class="summary-item">                        <div class="value" id="summary-cn">0</div>                        <div class="label">有效汉字</div>                    </div>                    <div class="summary-item">                        <div class="value" id="summary-turns">0</div>                        <div class="label">总楼数</div>                    </div>                    <div class="summary-item">                        <div class="value" id="summary-files">0</div>                        <div class="label">文件数</div>                    </div>                </div>            </div>            <!-- --- HTML结构结束 --- -->                        <div id="fileListContainer"></div>        </div>    </div></div><script>let masterFileData = [];let currentSortKey = 'effectiveCN';document.getElementById('fileInput').addEventListener('change', async (event) => {    // 这部分解析文件的代码与您提供的完全一致，未做任何修改    const file = event.target.files[0];    if (!file) return;    const statusEl = document.getElementById('status');    const resultAreaEl = document.getElementById('resultArea');        // (为了简洁，省略了未修改的JS代码，实际运行时这里是您完整的、正确的解析逻辑)    statusEl.textContent = '正在进行终极分析，请稍候...';    resultAreaEl.classList.remove('show');    masterFileData = [];     try {        const zip = await JSZip.loadAsync(file);        let grandTotal = { effectiveCN: 0, rawCN: 0, all: 0, files: 0, userTurns: 0, charTurns: 0, thinkingTags: 0 };        const processingPromises = [];        zip.forEach((relativePath, zipEntry) => {            if (zipEntry.dir || zipEntry.name.startsWith('__') || zipEntry.name.includes('.DS_Store')) return;            const promise = zipEntry.async('text').then(originalText => {                const allCount = originalText.length;                const rawCnCount = (originalText.match(/[\u4e00-\u9fa5]/g) || []).length;                const userTurns = (originalText.match(/"is_user":\s*true/g) || []).length;                const charTurns = (originalText.match(/"is_user":\s*false/g) || []).length;                const thinkingTagsCount = (originalText.match(/<thinking>/gi) || []).length;                const cleanedText = originalText.replace(/<thinking>[\s\S]*?<\/thinking>/gi, '');                const effectiveCnCount = (cleanedText.match(/[\u4e00-\u9fa5]/g) || []).length;                grandTotal.all += allCount;                grandTotal.rawCN += rawCnCount;                grandTotal.userTurns += userTurns;                grandTotal.charTurns += charTurns;                grandTotal.thinkingTags += thinkingTagsCount;                grandTotal.effectiveCN += effectiveCnCount;                grandTotal.files++;                masterFileData.push({                    name: zipEntry.name,                    effectiveCN: effectiveCnCount,                    all: allCount,                    totalTurns: userTurns + charTurns,                    userTurns: userTurns,                    thinkingTags: thinkingTagsCount                });            });            processingPromises.push(promise);        });        await Promise.all(processingPromises);                // 渲染全局数据面板 (HTML结构和逻辑未变)        document.querySelector('.dashboard').innerHTML = `            <div class="main-stat">                <div class="value" id="grandTotalEffectiveCN">${grandTotal.effectiveCN.toLocaleString()}</div>                <div class="label">有效汉字总数 (已过滤思维链)</div>            </div>            <div class="divider"></div>            <div class="sub-stats-grid">                <div><div class="value" id="totalFiles">${grandTotal.files.toLocaleString()}</div><div class="label">文件总数</div></div>                <div><div class="value" id="grandTotalTurns">${(grandTotal.userTurns + grandTotal.charTurns).toLocaleString()}</div><div class="label">总对话楼数</div></div>                <div><div class="value" id="grandTotalThinking">${grandTotal.thinkingTags.toLocaleString()}</div><div class="label">总思维链</div></div>            </div>            <div class="raw-data-row">                <span>原始汉字: <strong id="grandTotalRawCN">${grandTotal.rawCN.toLocaleString()}</strong></span>                <span>原始总字符: <strong id="grandTotalAll">${grandTotal.all.toLocaleString()}</strong></span>            </div>`;        document.querySelector('.sort-buttons').innerHTML = `            <button class="sort-btn active" data-sort="effectiveCN">按有效汉字</button>            <button class="sort-btn" data-sort="totalTurns">按总楼数</button>            <button class="sort-btn" data-sort="name">按文件名</button>`;        updateDisplay();         statusEl.textContent = '分析完成！';        statusEl.style.color = 'var(--text-sub)';        resultAreaEl.classList.add('show');    } catch (error) {        console.error('解析失败:', error);        statusEl.textContent = '解析失败，请确保是标准的 ZIP 文件。';        statusEl.style.color = '#d93025';    }});// 事件监听器部分保持不变document.getElementById('searchBox').addEventListener('input', updateDisplay);document.getElementById('sortButtons').addEventListener('click', (e) => {    if (e.target.tagName === 'BUTTON') {        currentSortKey = e.target.dataset.sort;        document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));        e.target.classList.add('active');        updateDisplay();    }});// --- 核心修改：升级 updateDisplay 函数 ---function updateDisplay() {    const searchTerm = document.getElementById('searchBox').value.toLowerCase();    const summaryPanel = document.getElementById('search-summary');    // 1. 过滤    const filteredData = masterFileData.filter(file => file.name.toLowerCase().includes(searchTerm));    // --- 新增逻辑：计算并更新搜索结果汇总 ---    if (searchTerm) {        let summaryCN = 0;        let summaryTurns = 0;        filteredData.forEach(file => {            summaryCN += file.effectiveCN;            summaryTurns += file.totalTurns;        });        document.getElementById('summary-cn').textContent = summaryCN.toLocaleString();        document.getElementById('summary-turns').textContent = summaryTurns.toLocaleString();        document.getElementById('summary-files').textContent = filteredData.length.toLocaleString();        summaryPanel.style.display = 'block'; // 显示面板    } else {        summaryPanel.style.display = 'none'; // 无搜索词时隐藏    }    // --- 新增逻辑结束 ---    // 2. 排序    filteredData.sort((a, b) => {        if (currentSortKey === 'name') {            return a.name.localeCompare(b.name, 'zh-Hans-CN');        } else {            return b[currentSortKey] - a[currentSortKey]; // 数字降序        }    });    // 3. 渲染    renderFileList(filteredData);}// renderFileList 函数保持不变function renderFileList(data) {    const container = document.getElementById('fileListContainer');    container.innerHTML = '';    if (data.length === 0) {        // 如果有搜索词但无结果        if (document.getElementById('searchBox').value) {            container.innerHTML = '<p style="text-align:center; color: var(--text-sub);">没有找到匹配的文件。</p>';        }        return;    }    data.forEach(item => {        const card = document.createElement('div');        card.className = 'file-card';        card.innerHTML = `            <div class="file-card-header">                <div class="file-card-name">${item.name}</div>                <div class="file-card-raw-chars">原始总字符: ${item.all.toLocaleString()}</div>            </div>            <div class="file-card-stats">                <div class="file-card-details">                    <div>用户发言: <strong>${item.userTurns.toLocaleString()} 次</strong></div>                    <div>总楼数: <strong>${item.totalTurns.toLocaleString()} 次</strong></div>                    <div>思维链: <strong>${item.thinkingTags.toLocaleString()} 次</strong></div>                </div>                <div class="file-card-cn">                    <div class="value">${item.effectiveCN.toLocaleString()}</div>                    <div class="label">有效汉字</div>                </div>            </div>        `;        container.appendChild(card);    });}</script></body></html>